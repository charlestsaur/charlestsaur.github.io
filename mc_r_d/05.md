<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

# ♟05丨红石电路特有的性质(特性),红石设计辅助工具

[<Previous](04.md) - [Index](index.md) - [Next>](06.md)

这节我们来了解一下红石具有的一些特性,利用这些特性,可以设计出更好的红石电路

## ■ 红石线的线或

<img src="https://i0.hdslb.com/bfs/article/db82d53e9d0761205cfe08cfd6ccb7b24165ae9d.png@!web-article-pic.avif"/>

现实中不允许让一根导线同时被输入"1"和"0"

红石与现实的区别之一就是红石线自带"线或",红石线的每一处都相当于一个或门,信号强度高的覆盖低的,除了红石线,被充能的普通方块,被充能的红石元件等等,也同理

<font color=MediumVioletRed>

利用红石线的"线或"可以实现无延迟或门(但最好别用)

</font>

  • 现实中的线或

现实中也存在"线或",甚至"线与"的概念(其实和红石不太一样).
但能使用的情景有限,所以一般情况还是就如上图那样,一根导线是不允许同时接受"1"和"0"两种输入的

## ■ 信号强度

一般来说我们只会关注元件的激活/非激活,红石线的亮/不亮.
但是实际上,对于一些红石元件来说,红石信号是有信号强度之分的

比如对于红石线来说,总共有0~15一共16种信号强度,并且比较器能对信号强度进行比较或者减法,基于这些性质,我们就可以设计所谓的"模红电路",即处理信号强度的电路

"模红电路"的优势是带宽较大,输入和可能输入0~15之间的任何信号强度.
事实上,一个0~15范围的信号强度输入足以代替4个非"1"即"0"的输入

• 模红电路的局限性

"模红电路"也有巨大的缺点:红石线会随着距离衰减信号强度,因此为了传导"模红信号"(范围为0~15的红石信号),必须使用延迟更高或者体积更大的导线电路

此外,模红电路要实现位运算也相对麻烦.
但模红电路在存储上很方便

有些人想做出所谓的"模红CPU",实际上完全不可能比的过普通的"数红CPU",因为这涉及到许多模红电路的弱项.
总算下来得不偿失,因此不建议做"模红CPU"

• 模红电路的分类

<font color=MediumVioletRed>

一般将处理信号强度范围在0~15的模红电路称为"弱模电路".
通过BUG或命令方块还能产生大于15的信号强度(其实大家没必要在这上面花太多时间,一个插件直接搞定),用到大于15信号强度的电路统称"强模电路"

利用BUG或命令方块也能产生负信号,用到负信号强度的电路可以称作"渣模电路",负信号不能传播,只能传递1个比较器(同样大家没必要在这上面花太多时间,一个插件也可以直接搞定)

</font>

如果对一个输入信号非0的减法模式比较器两侧同时输入负强度信号,那么这个比较器的输出会反而增大.
非常神奇,但可惜至今没什么用途

此外,很多人直接将"模红电路"类比于现实中的模拟电路,但这并不是一回事.
请不要混淆(尽量不要使用bug)

## ■ 信号衰减

虽然红石线的信号衰减让人很头疼,但是有时候利用红石线的信号衰减能设计出意想不到的电路,封闭进位加法器(CCA)就是其中之一,它就利用到了信号强度衰减的性质

<img src="https://i0.hdslb.com/bfs/article/d2d36942850f796b23a324e222160b2e8deb66ea.png@1256w_638h_!web-article-pic.avif"/>

封闭进位加法器,我们以后会讨论它

## ■ 活塞,半砖,投掷器

• 活塞

粘性活塞是一个很特殊的红石元件,因为它可以推拉方块,而方块又可以阻断红石线.

利用活塞推拉方块可以阻断红石线,以此实现半边无延迟的与门.
活塞加法器就利用到了这个特性,实现了在8位加法器内进位无延迟,且没使用0t(或者叫瞬推)

• 半砖

至于半砖开始做或门就用到了,利用半砖可以让红石线只能单向传导信号

漏斗,萤石,玻璃(玻璃仅高版本)等方块也可以代替半砖,但是漏斗很卡!建议少用

<img src="https://i0.hdslb.com/bfs/article/eea6ac4bdf0eb92929d00c0722d9dc682e2cabd3.png@1256w_708h_!web-article-pic.avif"/>

用半砖上传信号,并且信号只能单向上传.
在BE的话,可以用玻璃实现类似的下传导线.
漏斗是容器,有时候在布线中有用

• 投掷器

投掷器发射物品时候会从内部随机挑一个物品格发射,基于此可以设计出非常简单方便的伪随机数生成器,且经过调整,可以支持多种不同的概率.

<img src="https://i0.hdslb.com/bfs/article/2515886f00688c2e67ab7f48965a75223e93e85c.png@!web-article-pic.avif"/>

该投掷器有$\dfrac{1}{9}$的概率掷出水桶

## ■ 无延迟电路

JE存在大量无延迟特性,使得我们可以设计各种无延迟电路(尽量不要使用bug)

无延迟的原理涉及深层游戏机制(游戏源码),此处不做讨论

无延迟中继器和无延迟导线最实用,也用得最多.
但大量使用无延迟会有巨大副作用.
几个无延迟中继器与导线如下图:

<img src="https://i0.hdslb.com/bfs/article/1e9829bc4575daf23536ff902c5e986b1592c6d3.png@1256w_708h_!web-article-pic.avif"/>

下面的是无延迟中继器,上面的是无延迟导线.
如果按一下那个无延迟导线的按钮,整个导线都会同时收回红石块,然后又马上推出方块.
两元件仅JE可用!

剖析MC系列中介绍了一些无延迟导线方案

<https://www.youtube.com/watch?v=yYn3CFczLm8>

比较器也可以无延迟,但是似乎不是总是稳定的.
此外逻辑门也可以无延迟(尽量不要使用bug)

▶附页补充了其它无延迟电路设计◀

• 无延迟电路的局限性

无延迟电路虽然可以一瞬间完成运作,但是体积通常巨大.
不仅很卡,控制不当还很容易坏,导致修复调试火葬场,没人愿意调试一台这样如此容易出问题的电路

而且,一般的无延迟电路运作一次后,通常都需要等待一段时间让元件复位

这就是说,在复位的这段时间里不能再次运作(不然可能就坏了).
因此,无延迟电路的处理频率(每秒完成的处理次数)不一定高,无延迟电路的处理频率被复位延迟限制了

<font color=MediumVioletRed>

大部分无延迟元件较有延迟元件更容易故障,即可稳健性更低

</font>

有些人想用纯无延迟电路做出所谓的"无延迟CPU",但实际上这是无稽之谈,因为CPU更关注处理频率,而不是延迟

<font color=MediumVioletRed>

无延迟电路虽然可以一瞬间完成运算,但是复位不一定快.
因此完成一个操作后,必须等电路复位后才能开始执行下一个操作

</font>

而一条指令的执行可能等待很多次复位,尤其是采用流水化技术,时序更复杂的处理器,情况更严重.
无延迟便得不偿失

<font color=MediumVioletRed>

因此,不要滥用无延迟电路

</font>

• 在红石数字电路中使用无延迟导线

无延迟也并非一无是处.
实际设计中,也经常会用到无延迟导线作为控制线传输一些控制信号,尤其是传输距离有些远的时候.
原因是没有延迟更方便时序同步

电路中,很多导线并不需要24小时高强度高频率传输信号,而处于无延迟元件能接受的传输频率范围内(频率过高的话无延迟导线通常会出各种问题)

在较长的数据线上,也可以使用无延迟导线降低延迟,且根据Mojang写的奇怪更新机制,无延迟导线有时反而卡顿更低(不过会写插件的朋友可以自己调整,不会的就找人帮忙吧)

总之,<font color=MediumVioletRed>如果传输距离较大,且信号传输频率在无延迟导线正常工作的频率范围内,那么无延迟导线是一个很好的选择,它会让时序设计更轻松,也能改善延迟</font>

但无延迟导线外的其它无延迟元件,如无延迟逻辑门,就很少很少会用到了

<font color=MediumVioletRed>在CPU的运算器件中使用无延迟会导致一场灾难</font>(当然,如果只是是那种单次计算加减乘除之类的计算器中使用的并行运算器,那么随意)

另外,要避免让无延迟电路接收短脉冲.
有时这种短脉冲会以一种意想不到的方式产生,无延迟电路也可能以其它意想不到方式出问题,各种原因导致了<font color=MediumVioletRed>无延迟电路调试困难</font>

## ■ bud

bud是JE的特性,相信大家早已有所耳闻.有关bud的一些介绍可以在Minecraft Wiki看到

Minecraft Wiki中有关bud的中文界面:

<https://minecraft.fandom.com/wiki/Tutorials/Block_update_detector>

利用bud可以制作bud存储器等电路,但现在中继器,比较器锁存器用的更多

<img src="https://i0.hdslb.com/bfs/article/4da37e35d643e05e00628055b101dcc13abe8bdd.png@1256w_708h_!web-article-pic.avif"/>

奇怪的红石块隔空激活现象.
只有在JE版本才能体验这种奇怪特性(大佬说这个东西原因是qc,然后qc可以导致bud.不太懂.但是我们是弄红石数电的,不用太纠缠于这个的术语!)有关这类游戏特性的介绍,可以看看"剖析MC"系列视频.
还有各种TIS等生电大佬的视频

## ■ tick流水

tick流水类似现实中的"延迟线"概念,举个例子如下图:

<img src="https://i0.hdslb.com/bfs/article/6f1323bdfdb6a3a826c7eb03b204864dc01cfa38.png@1256w_708h_!web-article-pic.avif"/>

tick流水异或门,其实就是不停的输入数据,然后不停的产生运算结果,即使上一个运算还没结束.
也会马上把待算数据送进去,如果运算器不能处理过高频率的输入,那就只能降低输入的频率

tick流水能快速进行大量运算(但是这些运算必须相互独立,也就是无需等待上个运算的结果),不过<font color=MediumVioletRed>tick流水电路的时序设计和调试难度很高</font>,非常考验耐心和水平

为了让电路性能更好,大家经常会把tick流水的电路频率紧逼到2ticks处理一个运算,但这会带来了许多设计上的挑战,导致电路设计与调试难度极高

总之如果你的水平、专业知识很高的话可以尝试使用后再确定怎么弄

有时不妨放慢电路的处理频率,比如改成3ticks处理一个运算,或者4ticks.
这样就大大减轻了时序设计上的一些压力.
不仅降低了设计难度,还减轻了工作量

<font color=MediumVioletRed>

如果运用好的话,tick流水能提供非常强大的运算效率.
是传统串行运算器无法比拟的

</font>

如下就是一个tick流水运算器的例子,运算吞吐量高达每2ticks一个除法运算:

<https://www.youtube.com/watch?v=gViE6ZgirS0>

tick流水不仅可以用在运算器,也可以用在存储器中,类似现实中的"水银延迟线存储器",如下是tick流水存储器的例子,存储密度很高:

<https://www.youtube.com/watch?v=1zE_XZLTDBw&t>

在MC中,我们可以利用mod和第三方软件对电路进行复制粘贴和保存.
这对红石电路设计来说十分重要

这些工具中,WorldEdit,Litematic,Carpet这几个工具是游戏模组或者插件,如果你比较懒或者不会装模组,可以直接在网上找一个带有这些mod的整合包(整理有点麻烦,所以请各位自己去找,以后有时间我会专门做一个整合包💼)

但要注意的是,很多工具的导出文件(schematic文件,schem文件,litematic文件等),不能同时支持1.12及以下版本,和1.13及以上版本

我唯一知道能将这些文件中的电路进行跨版本迁移的方法就是开一个支持多版本进服的服务器,然后通过这个服务器来交流1.12和1.13+的电路

并且这个办法不是完美的,一些容器,比如熔炉内的物品会丢失

接下来对一些设计辅助工具进行简介:

• 原版命令

不多说,难用,/clone还有最大范围限制.

• 结构方块

难用,最大范围限制32x32x32.

• WorldEdit

俗称小木斧或WE,可以找到单机版和服务器版.适合复制粘贴重复电路.并且能够导入导出schematic文件

有关WE的教程和指令列表可以看:

<http://mineplugin.org/WorldEdit>

<img src="https://i0.hdslb.com/bfs/article/b09031dc7284068f6db20cb72b959aa23b9b4358.png@1256w_876h_!web-article-pic.avif"/>

WorldEdit的一些红石玩家常用指令

WE导出的schematic文件通常会被放在.minecraft\config\worldedit这个文件夹里面,导入时扫描的也是这个文件夹

• McEdit

是一个独立于mc的软件,现在最新有1.5.6.0和2.0两个版本,后者Bug多.
目前均只支持1.12及以下版本的存档.
适合较大规模的复制粘贴,但是其实速度并不快

我们主要用到的是McEdit的复制粘贴,克隆工具.
以及导入导出schematic文件的功能

在McEdit中,按Ctrl+S才会把你的更改保存到存档里,记得随手保存!

• Litematic

俗称投影mod,<font color=MediumVioletRed>操作超级快</font>,比McEdit还快

即使只在本地客服端有投影mod也可以在服务器中使用(把单机的东西投进去,或者把服务器里的东西投影出来).适合用来跨服跨存档搬东西

• Carpet Mod

Carpet是一个功能非常强大的模组,可以用来辅助分析红石电路运行.
打了Carpet的客服端一般俗称地毯端

Carpet加入了大量用于辅助分析电路运行的指令,如:

/tick warp 让游戏在一段时间内以最高速度运行.(而不是最高10ticks每秒)

/tick freeze 冻结游戏,暂停游戏tick,所有红石电路都会被暂停,再输一次解冻

/tick step 在游戏冻结时,让游戏解冻一段时间(可指定时间长度,精确到1 gametick)

Carpet也优化了许多游戏卡顿问题,让游戏运行更流畅.
并且修复了一些原版的bug(这个修复不会影响到我们的电路)

有关Carpet的介绍与下载链接在下方这个视频里都有:

<https://youtu.be/Lt-ooRGpLz4>

这个视频教程,视频评论区置顶评论标注了这个视频介绍内容的时间点,方便快速查找

各种生电服务器比如TIS对Carpet进行了各种魔改,增加各种各样的功能.
如果需要也可以去找,但一般来说原版Carpet就够了

• 程序接口

用Minecraft API或者Forge API等接口控制程序,可以实现许多不同的高级或复杂操作

• 电路仿真软件

我们可以借助电路仿真软件来设计和测试逻辑电路,电路仿真软件可以直观迅速地指出设计中的一些基本毛病,并且可以很方便地快速验证电路功能

如果你会硬件描述语言的话,也可以直接用硬件描述语言(如VerilogHDL)设计电路

参考软件: Logisim,Multisim,Proteus等

---

[<Previous](04.md) - [Index](index.md) - [Next>](06.md)